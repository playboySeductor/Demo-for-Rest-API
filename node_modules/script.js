const express = require('express'); //import express
const Joi=require('joi');           //import joi
const app=express();          //create express applic on app variable
app.use(express.json());       // used the json file

// data is stored in json format 

//Give data to the server..
const customers = [
    {title: 'George', id:1},
    {title: 'Josh', id:2},
    {title: 'Warrior',id:3},
    {title: 'Robert',id:4},
    {title: 'Andrew Pani',id:5},
    {title: 'Lionel Messi', id:6},
    {title:'Brendon McCullum Bazz', id:7}
]
//Read Request Handlers 
//Display the Message when the URL consist of '/'

app.get('/', (req,res)=>{
    res.send('Welcome to basic api project !!!');
});
 // Display the list of customers when URL consists of api customers
 app.get('/api/customers',(req,res)=>{
     res.send(customers);
 });
// Display the info of specific customer when you mention the id
app.get('/api/customers/:id',(req,res)=>{
    const customer = customers.find(c=>c.id=== parseInt(req.params.id));
    // if there is no valid customer then display an error mssg
    if(!customer) res.status(404).send('<h2>Oooops...Cant find what you are looking for !</h2>');

//    const index= customers.indexOf(customer);
  //  customers.splice(index,1);

    res.send(customer);
});

//create request handler
//create new customer info

app.post('/api/customers',(req,res)=>{
    const {error}= validateCustomer(req.body);
    if(error){
        res.status(400).send(error.details[0].message)
        return;
    }

    // increment the customer id
    const customer ={
        id: customers.length+1,
        title: req.body.title
    };
    customers.push(customer);
    res.send(customer);
});

//validate function

function validateCustomer(customer) {
    const schema ={
        title: Joi.string().min(3).required()
    };
    return Joi.validate(customer,schema);
}


//port environment variable
const port = process.env.PORT || 8080;
app.listen(port,()=> console.log(`Listening on port ${port}..`));